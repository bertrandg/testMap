{"version":3,"sources":["scripts/app-7e6abb8a80.js"],"names":["angular","module","erMap","ErMapController","$log","$timeout","$element","GeoDataService","addMarkers","list","markers","clearLayers","map","removeLayer","length","mapWIP","console","time","markerList","i","a","latitude","longitude","marker","L","Marker","LatLng","id","push","addLayers","addLayer","updateProgressBar","processed","total","elapsed","layersArray","progress","$","progressBar","style","display","width","Math","round","timeEnd","Map","center","zoom","layers","TileLayer","maxZoom","MarkerClusterGroup","chunkedLoading","chunkProgress","subscribe","log","directive","restrict","templateUrl","scope","controller","controllerAs","bindToController","$inject","erGrid","ErGridController","GridService","vm","this","gridOptions","api","setRowData","erMain","ErMainController","FilterService","totalDisplayItems","loadData","ErFilterController","$uibModalInstance","filter","datepickerOptions","date","dateA","opened","dateB","removeAll","close","filterData","cancel","dismiss","UtilsService","$filter","formatDate","Service","factory","dateComparator","date1","date2","date1Number","monthToComparableNumber","date2Number","undefined","yearNumber","substring","monthNumber","dayNumber","result","cellRendererGender","params","value","columnDefs","headerName","field","comparator","cellRenderer","enableSorting","pinnedColumnCount","rowData","$http","$q","Files","loadDataComplete","results","forEach","_list","concat","data","totalItems","_observer","onNext","loadDataFailed","error","toJson","all","item","method","url","then","name","enabled","gender","position","_filteredList","indexOf","startLatValue","endLatValue","startLngValue","endLngValue","startValue","registered","endValue","Icon","Default","imagePath","Rx","Observable","create","observer","share","$uibModal","$sce","openModal","modalInstance","open","animation","size","refreshData","info","Date","removeAllAndRefresh","filterDisplayText","getDisplay","_currentFilter","txt","trustAsHtml","formatYear","startingDay","routerConfig","$stateProvider","$urlRouterProvider","state","template","otherwise","config","constant","$logProvider","debugEnabled","run","$templateCache","put"],"mappings":"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","file":"scripts/app-7e6abb8a80.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('app', [\n      'ngAnimate',\n      'ngTouch',\n      'ngSanitize',\n      'ngAria',\n      'ui.router',\n      'ui.bootstrap',\n      'agGrid'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .directive('erMap', erMap);\n\n  /** @ngInject */\n  function erMap() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/map/erMap.tpl.html',\n      scope: {},\n      controller: ErMapController,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function ErMapController($log, $timeout, $element, GeoDataService) {\n      var vm = this;\n      \n      var map = new L.Map('map', {\n        center: new L.LatLng(45.755658, 4.834432), \n        zoom: 13, \n        layers: [new L.TileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { maxZoom: 21 })]\n      });\n\n      var markers = new L.MarkerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgressBar });\n\n      GeoDataService.list.subscribe(function(list) {\n        $log.log('Observable subscriber called ---> MAP ', list.length);\n        addMarkers(list);\n      })\n\n      function addMarkers(list) {\n        markers.clearLayers();\n        map.removeLayer(markers);\n\n        if(list.length == 0) return;\n\n        GeoDataService.mapWIP = true;\n        console.time('clustering');\n\n        var markerList = [];\n        for (var i = 0; i < list.length; i++) {\n          var a = list[i];\n          if(a.latitude && a.longitude) {\n            var marker = new L.Marker(new L.LatLng(a.latitude, a.longitude), { id: a.id });\n            markerList.push(marker);\n          }\n        }\n\n        markers.addLayers(markerList);\n        //markers.on('click', clickMarker);\n        map.addLayer(markers);\n      }\n\n      function updateProgressBar(processed, total, elapsed, layersArray) {\n        var progress = $('#progress', $element)[0];\n        var progressBar = $('#progress-bar', $element)[0];\n\n        if (elapsed > 1000) {\n          progress.style.display = 'block';\n          progressBar.style.width = Math.round(processed/total*100) + '%';\n        }\n\n        if (processed === total) {\n          progress.style.display = 'none';\n\n          console.timeEnd('clustering');\n\n          $timeout(function() {\n            GeoDataService.mapWIP = false;\n          })\n        }\n      }\n\n      function clickMarker(e) {\n        $log.info('click > ', e);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .directive('erGrid', erGrid);\n\n  /** @ngInject */\n  function erGrid() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/grid/erGrid.tpl.html',\n      scope: {},\n      controller: ErGridController,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function ErGridController($log, $timeout, GeoDataService, GridService) {\n      var vm = this;\n\n      vm.gridOptions = GridService.gridOptions;\n\n      GeoDataService.list.subscribe(function(list) {\n        $log.log('Observable subscriber called ---> GRID ', list.length);\n\n        vm.gridOptions.api.setRowData(list);\n      });\n    }\n  }\n\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .directive('erMain', erMain);\r\n\r\n  /** @ngInject */\r\n  function erMain() {\r\n    var directive = {\r\n      restrict: 'E',\r\n      templateUrl: 'app/components/main/erMain.tpl.html',\r\n      scope: {},\r\n      controller: ErMainController,\r\n      controllerAs: 'vm',\r\n      bindToController: true\r\n    };\r\n\r\n    return directive;\r\n\r\n    /** @ngInject */\r\n    function ErMainController($log, GeoDataService, FilterService) {\r\n      var vm = this;\r\n\r\n      vm.GeoDataService = GeoDataService;\r\n      vm.FilterService = FilterService;\r\n      vm.totalDisplayItems = 0;\r\n\r\n      GeoDataService.list.subscribe(function(list) {\r\n        $log.log('Observable subscriber called ---> MAIN ', list.length);\r\n        vm.totalDisplayItems = list.length;\r\n      });\r\n\r\n      GeoDataService.loadData();\r\n    }\r\n  }\r\n\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .controller('ErFilterController', ErFilterController);\n\n  /** @ngInject */\n  function ErFilterController($uibModalInstance, $log, FilterService) {\n    var vm = this;\n\n    vm.filter = FilterService.filter;\n    vm.datepickerOptions = FilterService.datepickerOptions;\n    vm.date = {\n      dateA: {\n        opened: false\n      },\n      dateB: {\n        opened: false\n      }\n    }\n\n    vm.removeAll = function() {\n      FilterService.removeAll();\n      $uibModalInstance.close(vm.filter);\n    };\n\n    vm.filterData = function() {\n      $uibModalInstance.close(vm.filter);\n    };\n\n    vm.cancel = function() {\n      $uibModalInstance.dismiss('cancel');\n    };\n\n  }\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('UtilsService', UtilsService);\r\n\r\n  /** @ngInject */\r\n  function UtilsService($filter) {\r\n\r\n    var Service = {\r\n      formatDate: formatDate\r\n    };\r\n\r\n    function formatDate(date) {\r\n      return $filter('date')(date, 'dd/MM/yyyy');\r\n    }\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('GridService', GridService);\r\n\r\n  /** @ngInject */\r\n  function GridService() {\r\n\r\n    var columnDefs = [\r\n      {headerName: \"Nom\", field: \"name\"},\r\n      {headerName: \"Date\", field: \"registered\", width: 110, comparator: dateComparator},\r\n      {headerName: \"Genre\", field: \"gender\", width: 90, cellRenderer: cellRendererGender},\r\n      {headerName: \"Téléphone\", field: \"phone\"},\r\n      {headerName: \"Lat\", field: \"latitude\", width: 90},\r\n      {headerName: \"Lon\", field: \"longitude\", width: 90},\r\n      {headerName: \"Id\", field: \"id\"}\r\n    ];\r\n\r\n    var gridOptions = {\r\n      columnDefs: columnDefs,\r\n      enableSorting: true,\r\n      pinnedColumnCount: 1,\r\n      rowData: []\r\n    };\r\n\r\n    var Service = {\r\n      gridOptions: gridOptions,\r\n      dateComparator: dateComparator\r\n    };\r\n\r\n    function dateComparator(date1, date2) {\r\n      var date1Number = monthToComparableNumber(date1);\r\n      var date2Number = monthToComparableNumber(date2);\r\n\r\n      if (date1Number===null && date2Number===null) {\r\n        return 0;\r\n      }\r\n      if (date1Number===null) {\r\n        return -1;\r\n      }\r\n      if (date2Number===null) {\r\n        return 1;\r\n      }\r\n\r\n      return date1Number - date2Number;\r\n    }\r\n\r\n    function monthToComparableNumber(date) {\r\n      if (date === undefined || date === null || date.length !== 10) {\r\n          return null;\r\n      }\r\n\r\n      var yearNumber = date.substring(6,10);\r\n      var monthNumber = date.substring(3,5);\r\n      var dayNumber = date.substring(0,2);\r\n\r\n      var result = (yearNumber*10000) + (monthNumber*100) + dayNumber;\r\n      return result;\r\n    }\r\n\r\n    function cellRendererGender(params) {\r\n      if (params.value == 'female') {\r\n        return 'Femme';\r\n      } else {\r\n        return 'Homme';\r\n      }\r\n    }\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('GeoDataService', GeoDataService);\n\n  /** @ngInject */\n  function GeoDataService($log, $http, $timeout, $q, GridService, UtilsService, Files) {\n    var _list = [];\n    var _filteredList = [];\n    var _observer;\n\n    L.Icon.Default.imagePath = 'assets/images/leaflet';\n\n    var Service = {\n      loadData: loadData,\n      filterData: filterData,\n      totalItems: 0,\n      mapWIP: true,\n      list: Rx.Observable.create(function(observer) {\n        _observer = observer;\n      }).share()\n    };\n\n    $timeout(function() {\n      _observer.onNext(_list);\n    });\n\n    function loadData() {\n      $q.all(Files.map(function (item) {\n        return $http({\n          method: 'GET',\n          url: item\n        });\n      })).then(loadDataComplete).catch(loadDataFailed);\n\n      function loadDataComplete(results) {\n        angular.forEach(results, function (result) {\n          _list = _list.concat(result.data);\n        });\n\n        \n        $timeout(function() {\n          Service.totalItems = _list.length;\n          _observer.onNext(_list);\n        }, 1000);\n      }\n\n      function loadDataFailed(error) {\n        $log.error('XHR Failed for getData.' + angular.toJson(error.data, true));\n      }\n    }\n\n    function filterData(filter) {\n\n      $timeout(function() {\n\n        // Si aucun filtre activé, on retourne la liste compléte\n        if( !filter.name.enabled && !filter.gender.enabled && !filter.position.enabled && !filter.date.enabled )\n        {\n          _observer.onNext(_list);\n          return;\n        }\n\n        _filteredList = _list.filter(function(item) {\n\n          // Filter on NAME\n          if( filter.name.enabled && \n              filter.name.value != '' && \n              item.name.indexOf(filter.name.value) == -1 )\n                return false;\n\n          // Filter on GENDER\n          if( filter.gender.enabled && \n              filter.gender.value != '' && \n              item.gender != filter.gender.value ) \n                return false;\n\n          // Filter on POSITION\n          if(filter.position.enabled) {\n            if( filter.position.startLatValue != '' && \n                item.latitude < filter.position.startLatValue ) \n                  return false;\n\n            if( filter.position.endLatValue != '' && \n                item.latitude > filter.position.endLatValue ) \n                  return false;\n\n            if( filter.position.startLngValue != '' && \n                item.longitude < filter.position.startLngValue ) \n                  return false;\n\n            if( filter.position.endLngValue != '' && \n                item.longitude > filter.position.endLngValue ) \n                  return false;\n          }\n\n          // Filter on DATE\n          if(filter.date.enabled) {\n            if( filter.date.startValue != '' && \n                GridService.dateComparator(UtilsService.formatDate(filter.date.startValue), item.registered) > 0 ) \n                  return false;\n\n            if( filter.date.endValue != '' && \n                GridService.dateComparator(UtilsService.formatDate(filter.date.endValue), item.registered) < 0 ) \n                  return false;\n          }\n          return true;\n        });\n\n        _observer.onNext(_filteredList);\n      });\n    }\n\n    return Service;\n  }\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('FilterService', FilterService);\r\n\r\n  /** @ngInject */\r\n  function FilterService($uibModal, $log, $sce, GeoDataService, UtilsService) {\r\n    var _currentFilter = {\r\n      name: {\r\n        enabled: false,\r\n        value: ''\r\n      },\r\n      date: {\r\n        enabled: false,\r\n        startValue: '',\r\n        endValue: ''\r\n      },\r\n      gender: {\r\n        enabled: false,\r\n        value: ''\r\n      },\r\n      position: {\r\n        enabled: false,\r\n        startLatValue: '',\r\n        endLatValue: '',\r\n        startLngValue: '',\r\n        endLngValue: ''\r\n      }\r\n    };\r\n\r\n    var datepickerOptions = {\r\n      formatYear: 'yy',\r\n      startingDay: 1\r\n    };\r\n\r\n    var Service = {\r\n      filter: _currentFilter,\r\n      datepickerOptions: datepickerOptions,\r\n      filterDisplayText: getDisplay(),\r\n      openModal: openModal,\r\n      removeAll: removeAll,\r\n      removeAllAndRefresh: removeAllAndRefresh\r\n    };\r\n\r\n\r\n    function openModal() {\r\n      var modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: 'app/components/filter/erFilter.tpl.html',\r\n        controller: 'ErFilterController',\r\n        controllerAs: 'vm',\r\n        bindToController: true,\r\n        size: 'lg'\r\n      });\r\n\r\n      modalInstance.result.then(function () {\r\n        refreshData();\r\n      }, function () {\r\n        $log.info('Modal dismissed at: ' + new Date());\r\n      });\r\n    }\r\n\r\n    function removeAll() {\r\n      Service.filter.name.enabled = false;\r\n      Service.filter.date.enabled = false;\r\n      Service.filter.gender.enabled = false;\r\n      Service.filter.position.enabled = false;\r\n    }\r\n\r\n    function removeAllAndRefresh() {\r\n        removeAll();\r\n        refreshData();\r\n    }\r\n\r\n    function refreshData() {\r\n      Service.filterDisplayText = getDisplay();\r\n      GeoDataService.filterData(_currentFilter);\r\n    }\r\n\r\n    function getDisplay() {\r\n      var txt = '';\r\n\r\n      if(_currentFilter.name.enabled && _currentFilter.name.value != '') {\r\n        txt += '<span>Nom: <span class=\"val\">' + _currentFilter.name.value + '</span></span>';\r\n      }\r\n      if(_currentFilter.gender.enabled && _currentFilter.gender.value != '') {\r\n        txt += '<span>Genre: <span class=\"val\">' + (_currentFilter.gender.value == 'male' ? 'Homme' : 'Femme') + '</span></span>';\r\n      }\r\n      if(_currentFilter.date.enabled) {\r\n        if(_currentFilter.date.startValue != '') txt += '<span>Date début: <span class=\"val\">' + UtilsService.formatDate(_currentFilter.date.startValue) + '</span></span>';\r\n        if(_currentFilter.date.endValue != '') txt += '<span>Date fin: <span class=\"val\">' + UtilsService.formatDate(_currentFilter.date.endValue) + '</span></span>';\r\n      }\r\n      if(_currentFilter.position.enabled) {\r\n        if(_currentFilter.position.startLatValue != '') txt += '<span>Lat min: <span class=\"val\">' + _currentFilter.position.startLatValue + '</span></span>';\r\n        if(_currentFilter.position.endLatValue != '') txt += '<span>Lat max: <span class=\"val\">' + _currentFilter.position.endLatValue + '</span></span>';\r\n        if(_currentFilter.position.startLngValue != '') txt += '<span>Lng min: <span class=\"val\">' + _currentFilter.position.startLngValue + '</span></span>';\r\n        if(_currentFilter.position.endLngValue != '') txt += '<span>Lng max: <span class=\"val\">' + _currentFilter.position.endLngValue + '</span></span>';\r\n      }\r\n\r\n      return (txt == '' ? ' <span class=\"val\">Aucun filtre</span>' : $sce.trustAsHtml(txt));\r\n    }\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/map',\n        template: '<er-main></er-main>'\n      });\n\n    $urlRouterProvider.otherwise('/map');\n  }\n\n})();\n\n/* global malarkey:false, moment:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .constant('Files', [\n      'assets/data/positions.json', \n      'assets/data/positions2.json', \n      'assets/data/positions3.json'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n  }\n\n})();\n\nangular.module(\"app\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/filter/erFilter.tpl.html\",\"<div class=\\\"erFilter\\\"><div class=\\\"modal-header\\\"><h3 class=\\\"modal-title\\\">Critères de filtrage:</h3></div><div class=\\\"modal-body\\\"><form name=\\\"vm.mainForm\\\" class=\\\"form-inline\\\"><table class=\\\"table table-hover\\\"><tbody><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.name.enabled\\\"> Nom:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.name.enabled}\\\"><form name=\\\"vm.nameForm\\\"><label>Contient: <input type=\\\"text\\\" ng-model=\\\"vm.filter.name.value\\\" ng-disabled=\\\"!vm.filter.name.enabled\\\" class=\\\"form-control\\\" required=\\\"\\\"></label></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.gender.enabled\\\"> Genre:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.gender.enabled}\\\"><form name=\\\"vm.genderForm\\\" class=\\\"form-inline\\\"><label class=\\\"radio-inline\\\"><input type=\\\"radio\\\" ng-model=\\\"vm.filter.gender.value\\\" ng-disabled=\\\"!vm.filter.gender.enabled\\\" name=\\\"inlineRadioOptions\\\" value=\\\"male\\\"> Homme</label> <label class=\\\"radio-inline\\\"><input type=\\\"radio\\\" ng-model=\\\"vm.filter.gender.value\\\" ng-disabled=\\\"!vm.filter.gender.enabled\\\" name=\\\"inlineRadioOptions\\\" value=\\\"female\\\"> Femme</label></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.date.enabled\\\"> Date:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.date.enabled}\\\"><form name=\\\"vm.dateForm\\\" class=\\\"form-inline\\\">Début:<div class=\\\"input-group\\\"><input type=\\\"date\\\" uib-datepicker-popup=\\\"dd/MM/yyyy\\\" ng-model=\\\"vm.filter.date.startValue\\\" is-open=\\\"vm.date.dateA.opened\\\" datepicker-options=\\\"vm.datepickerOptions\\\" date-disabled=\\\"!vm.filter.date.enabled\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\" close-text=\\\"Fermer\\\" class=\\\"form-control\\\" readonly=\\\"\\\"> <span class=\\\"input-group-btn\\\"><button type=\\\"button\\\" class=\\\"btn btn-default\\\" ng-click=\\\"vm.date.dateA.opened = true\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\"><i class=\\\"glyphicon glyphicon-calendar\\\"></i></button></span></div>- Fin:<div class=\\\"input-group\\\"><input type=\\\"date\\\" uib-datepicker-popup=\\\"dd/MM/yyyy\\\" ng-model=\\\"vm.filter.date.endValue\\\" is-open=\\\"vm.date.dateB.opened\\\" datepicker-options=\\\"vm.datepickerOptions\\\" date-disabled=\\\"!vm.filter.date.enabled\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\" close-text=\\\"Fermer\\\" class=\\\"form-control\\\" readonly=\\\"\\\"> <span class=\\\"input-group-btn\\\"><button type=\\\"button\\\" class=\\\"btn btn-default\\\" ng-click=\\\"vm.date.dateB.opened = true\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\"><i class=\\\"glyphicon glyphicon-calendar\\\"></i></button></span></div></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.position.enabled\\\"> Position:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.position.enabled}\\\"><form name=\\\"vm.positionForm\\\"><label>Latitude min: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.startLatValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-90\\\" max=\\\"90\\\" step=\\\"0.001\\\" required=\\\"\\\"></label> <label>Latitude max: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.endLatValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-90\\\" max=\\\"90\\\" step=\\\"0.001\\\" required=\\\"\\\"></label><br><label>Longitude min: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.startLngValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-180\\\" max=\\\"180\\\" step=\\\"0.001\\\" required=\\\"\\\"></label> <label>Longitude max: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.endLngValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-180\\\" max=\\\"180\\\" step=\\\"0.001\\\" required=\\\"\\\"></label></form></td></tr></tbody></table></form></div><div class=\\\"modal-footer\\\"><button class=\\\"btn btn-danger pull-left\\\" type=\\\"button\\\" ng-click=\\\"vm.removeAll()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Supprimer</button> <button class=\\\"btn btn-primary\\\" type=\\\"button\\\" ng-click=\\\"vm.cancel()\\\">Fermer</button> <button class=\\\"btn btn-primary\\\" type=\\\"button\\\" ng-click=\\\"vm.filterData()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\"><span class=\\\"glyphicon glyphicon-filter\\\"></span> Filtrer</button></div></div>\");\n$templateCache.put(\"app/components/grid/erGrid.tpl.html\",\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 class=\\\"panel-title text-center\\\">Grille</h3></div><div class=\\\"panel-body\\\"><div ag-grid=\\\"vm.gridOptions\\\" class=\\\"ag-fresh\\\"></div></div></div>\");\n$templateCache.put(\"app/components/main/erMain.tpl.html\",\"<nav class=\\\"navbar navbar-inverse\\\"><div class=\\\"container\\\"><p class=\\\"navbar-text filter-bloc\\\"><strong>Filtres:</strong> <span ng-bind-html=\\\"vm.FilterService.filterDisplayText\\\" class=\\\"filter-display\\\"></span> <button ng-click=\\\"vm.FilterService.openModal()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"btn btn-sm btn-primary\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span> Modifier</button> <button ng-click=\\\"vm.FilterService.removeAllAndRefresh()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"btn btn-sm btn-danger\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Supprimer</button> <span ng-show=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"glyphicon glyphicon-time\\\"></span></p><p class=\\\"navbar-text navbar-right\\\"><strong>Données affichées:</strong> {{ vm.totalDisplayItems + \\' / \\' + vm.GeoDataService.totalItems }}<button class=\\\"btn btn-sm btn-danger\\\" style=\\\"opacity: 0;\\\">X</button></p></div></nav><div class=\\\"container-fluid\\\"><div ng-if=\\\"vm.GeoDataService.totalItems == 0\\\" class=\\\"text-center\\\"><span class=\\\"badge\\\">Chargement des fichiers..</span></div><div ng-class=\\\"{\\'hideMe\\': vm.GeoDataService.totalItems == 0}\\\"><div class=\\\"col-md-6 col-sm-12\\\"><er-grid></er-grid></div><div class=\\\"col-md-6 col-sm-12\\\"><er-map></er-map></div></div></div>\");\n$templateCache.put(\"app/components/map/erMap.tpl.html\",\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 class=\\\"panel-title text-center\\\">Carte</h3></div><div class=\\\"panel-body\\\"><div id=\\\"progress\\\"><div id=\\\"progress-bar\\\"></div></div><div id=\\\"map\\\"></div></div></div>\");}]);"],"sourceRoot":"/source/"}