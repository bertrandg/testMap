{"version":3,"sources":["scripts/app-92e27570ea.js"],"names":["angular","module","erMap","ErMapController","$log","$timeout","$element","GeoDataService","addMarkers","list","map","removeLayer","markers","clearLayers","length","mapWIP","markerList","i","a","latitude","longitude","marker","L","Marker","LatLng","id","push","console","time","addLayers","on","clickMarker","addLayer","timeEnd","updateProgressBar","processed","total","elapsed","layersArray","progress","$","progressBar","style","display","width","Math","round","e","info","Map","center","zoom","layers","TileLayer","maxZoom","MarkerClusterGroup","chunkedLoading","chunkProgress","subscribe","log","directive","restrict","templateUrl","scope","controller","controllerAs","bindToController","$inject","ErFilterController","$uibModalInstance","FilterService","vm","this","filter","datepickerOptions","date","dateA","opened","dateB","removeAll","close","filterData","cancel","dismiss","erMain","ErMainController","totalDisplayItems","loadData","erGrid","ErGridController","GridService","gridOptions","api","setRowData","UtilsService","$filter","formatDate","Service","factory","dateComparator","date1","date2","date1Number","monthToComparableNumber","date2Number","undefined","yearNumber","substring","monthNumber","dayNumber","result","columnDefs","headerName","field","comparator","enableSorting","pinnedColumnCount","rowData","$http","$q","Files","loadDataComplete","results","forEach","_list","concat","data","totalItems","_observer","onNext","loadDataFailed","error","toJson","all","item","method","url","then","name","enabled","gender","position","_filteredList","value","indexOf","startLatValue","endLatValue","startLngValue","endLngValue","startValue","registered","endValue","Icon","Default","imagePath","Rx","Observable","create","observer","share","$uibModal","$sce","openModal","modalInstance","open","animation","size","refreshData","Date","removeAllAndRefresh","filterDisplayText","getDisplay","_currentFilter","txt","trustAsHtml","formatYear","startingDay","routerConfig","$stateProvider","$urlRouterProvider","state","template","otherwise","config","constant","$logProvider","debugEnabled","run","$templateCache","put"],"mappings":"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","file":"scripts/app-92e27570ea.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('app', [\n      'ngAnimate',\n      'ngTouch',\n      'ngSanitize',\n      'ngAria',\n      'ui.router',\n      'ui.bootstrap',\n      'agGrid'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .directive('erMap', erMap);\n\n  /** @ngInject */\n  function erMap() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/map/erMap.tpl.html',\n      scope: {},\n      controller: ErMapController,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function ErMapController($log, $timeout, $element, GeoDataService) {\n      var vm = this;\n      \n      var map = new L.Map('map', {\n        center: new L.LatLng(45.755658, 4.834432), \n        zoom: 13, \n        layers: [new L.TileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { maxZoom: 21 })]\n      });\n\n      var markers = new L.MarkerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgressBar });\n\n      GeoDataService.list.subscribe(function(list) {\n        $log.log('Observable subscriber called ---> MAP ', list.length);\n        addMarkers(list);\n      })\n\n      function addMarkers(list) {\n        map.removeLayer(markers);\n        markers.clearLayers();\n\n        if(list.length == 0) return;\n\n        GeoDataService.mapWIP = true;\n\n        var markerList = [];\n        for (var i = 0; i < list.length; i++) {\n          var a = list[i];\n          if(a.latitude && a.longitude) {\n            var marker = new L.Marker(new L.LatLng(a.latitude, a.longitude), { id: a.id });\n            markerList.push(marker);\n          }\n        }\n        console.time('clustering');\n\n        markers.addLayers(markerList);\n        markers.on('click', clickMarker);\n        map.addLayer(markers);\n\n        console.timeEnd('clustering');\n      }\n\n      function updateProgressBar(processed, total, elapsed, layersArray) {\n        var progress = $('#progress', $element)[0];\n        var progressBar = $('#progress-bar', $element)[0];\n\n        if (elapsed > 1000) {\n          progress.style.display = 'block';\n          progressBar.style.width = Math.round(processed/total*100) + '%';\n        }\n\n        if (processed === total) {\n          progress.style.display = 'none';\n\n          $timeout(function() {\n            GeoDataService.mapWIP = false;\n          })\n        }\n      }\n\n      function clickMarker(e) {\n        $log.info('click > ', e);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .controller('ErFilterController', ErFilterController);\n\n  /** @ngInject */\n  function ErFilterController($uibModalInstance, $log, FilterService) {\n    var vm = this;\n\n    vm.filter = FilterService.filter;\n    vm.datepickerOptions = FilterService.datepickerOptions;\n    vm.date = {\n      dateA: {\n        opened: false\n      },\n      dateB: {\n        opened: false\n      }\n    }\n\n    vm.removeAll = function() {\n      FilterService.removeAll();\n      $uibModalInstance.close(vm.filter);\n    };\n\n    vm.filterData = function() {\n      $uibModalInstance.close(vm.filter);\n    };\n\n    vm.cancel = function() {\n      $uibModalInstance.dismiss('cancel');\n    };\n\n  }\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .directive('erMain', erMain);\r\n\r\n  /** @ngInject */\r\n  function erMain() {\r\n    var directive = {\r\n      restrict: 'E',\r\n      templateUrl: 'app/components/main/erMain.tpl.html',\r\n      scope: {},\r\n      controller: ErMainController,\r\n      controllerAs: 'vm',\r\n      bindToController: true\r\n    };\r\n\r\n    return directive;\r\n\r\n    /** @ngInject */\r\n    function ErMainController($log, GeoDataService, FilterService) {\r\n      var vm = this;\r\n\r\n      vm.GeoDataService = GeoDataService;\r\n      vm.FilterService = FilterService;\r\n      vm.totalDisplayItems = 0;\r\n\r\n      GeoDataService.list.subscribe(function(list) {\r\n        $log.log('Observable subscriber called ---> MAIN ', list.length);\r\n        vm.totalDisplayItems = list.length;\r\n      });\r\n\r\n      GeoDataService.loadData();\r\n    }\r\n  }\r\n\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .directive('erGrid', erGrid);\n\n  /** @ngInject */\n  function erGrid() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/grid/erGrid.tpl.html',\n      scope: {},\n      controller: ErGridController,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function ErGridController($log, $timeout, GeoDataService, GridService) {\n      var vm = this;\n\n      vm.gridOptions = GridService.gridOptions;\n\n      GeoDataService.list.subscribe(function(list) {\n        $log.log('Observable subscriber called ---> GRID ', list.length);\n\n        vm.gridOptions.api.setRowData(list);\n      });\n    }\n  }\n\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('UtilsService', UtilsService);\r\n\r\n  /** @ngInject */\r\n  function UtilsService($filter) {\r\n\r\n    var Service = {\r\n      formatDate: formatDate\r\n    };\r\n\r\n    function formatDate(date) {\r\n      return $filter('date')(date, 'dd/MM/yyyy');\r\n    }\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('GridService', GridService);\r\n\r\n  /** @ngInject */\r\n  function GridService() {\r\n\r\n    var columnDefs = [\r\n      {headerName: \"Nom\", field: \"name\"},\r\n      {headerName: \"Date\", field: \"registered\", width: 110, comparator: dateComparator},\r\n      {headerName: \"Genre\", field: \"gender\", width: 90},\r\n      {headerName: \"Téléphone\", field: \"phone\"},\r\n      {headerName: \"Lat\", field: \"latitude\", width: 90},\r\n      {headerName: \"Lon\", field: \"longitude\", width: 90},\r\n      {headerName: \"Id\", field: \"id\"}\r\n    ];\r\n\r\n    var gridOptions = {\r\n      columnDefs: columnDefs,\r\n      enableSorting: true,\r\n      pinnedColumnCount: 1,\r\n      rowData: []\r\n    };\r\n\r\n    var Service = {\r\n      gridOptions: gridOptions,\r\n      dateComparator: dateComparator\r\n    };\r\n\r\n    function dateComparator(date1, date2) {\r\n      var date1Number = monthToComparableNumber(date1);\r\n      var date2Number = monthToComparableNumber(date2);\r\n\r\n      if (date1Number===null && date2Number===null) {\r\n        return 0;\r\n      }\r\n      if (date1Number===null) {\r\n        return -1;\r\n      }\r\n      if (date2Number===null) {\r\n        return 1;\r\n      }\r\n\r\n      return date1Number - date2Number;\r\n    }\r\n\r\n    function monthToComparableNumber(date) {\r\n      if (date === undefined || date === null || date.length !== 10) {\r\n          return null;\r\n      }\r\n\r\n      var yearNumber = date.substring(6,10);\r\n      var monthNumber = date.substring(3,5);\r\n      var dayNumber = date.substring(0,2);\r\n\r\n      var result = (yearNumber*10000) + (monthNumber*100) + dayNumber;\r\n      return result;\r\n    }\r\n\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('GeoDataService', GeoDataService);\n\n  /** @ngInject */\n  function GeoDataService($log, $http, $timeout, $q, GridService, UtilsService, Files) {\n    var _list = [];\n    var _filteredList = [];\n    var _observer;\n\n    L.Icon.Default.imagePath = 'assets/images/leaflet';\n\n    var Service = {\n      loadData: loadData,\n      filterData: filterData,\n      totalItems: 0,\n      mapWIP: true,\n      list: Rx.Observable.create(function(observer) {\n        _observer = observer;\n      }).share()\n    };\n\n    $timeout(function() {\n      _observer.onNext(_list);\n    });\n\n    function loadData() {\n      $q.all(Files.map(function (item) {\n        return $http({\n          method: 'GET',\n          url: item\n        });\n      })).then(loadDataComplete).catch(loadDataFailed);\n\n      function loadDataComplete(results) {\n        angular.forEach(results, function (result) {\n          _list = _list.concat(result.data);\n        });\n\n        \n        $timeout(function() {\n          Service.totalItems = _list.length;\n          _observer.onNext(_list);\n        }, 1000);\n      }\n\n      function loadDataFailed(error) {\n        $log.error('XHR Failed for getData.' + angular.toJson(error.data, true));\n      }\n    }\n\n    function filterData(filter) {\n\n      $timeout(function() {\n\n        // Si aucun filtre activé, on retourne la liste compléte\n        if( !filter.name.enabled && !filter.gender.enabled && !filter.position.enabled && !filter.date.enabled )\n        {\n          _observer.onNext(_list);\n          return;\n        }\n\n        _filteredList = _list.filter(function(item) {\n\n          // Filter on NAME\n          if( filter.name.enabled && \n              filter.name.value != '' && \n              item.name.indexOf(filter.name.value) == -1 )\n                return false;\n\n          // Filter on GENDER\n          if( filter.gender.enabled && \n              filter.gender.value != '' && \n              item.gender != filter.gender.value ) \n                return false;\n\n          // Filter on POSITION\n          if(filter.position.enabled) {\n            if( filter.position.startLatValue != '' && \n                item.latitude < filter.position.startLatValue ) \n                  return false;\n\n            if( filter.position.endLatValue != '' && \n                item.latitude > filter.position.endLatValue ) \n                  return false;\n\n            if( filter.position.startLngValue != '' && \n                item.longitude < filter.position.startLngValue ) \n                  return false;\n\n            if( filter.position.endLngValue != '' && \n                item.longitude > filter.position.endLngValue ) \n                  return false;\n          }\n\n          // Filter on DATE\n          if(filter.date.enabled) {\n            if( filter.date.startValue != '' && \n                GridService.dateComparator(UtilsService.formatDate(filter.date.startValue), item.registered) > 0 ) \n                  return false;\n\n            if( filter.date.endValue != '' && \n                GridService.dateComparator(UtilsService.formatDate(filter.date.endValue), item.registered) < 0 ) \n                  return false;\n          }\n          return true;\n        });\n\n        _observer.onNext(_filteredList);\n      });\n    }\n\n    return Service;\n  }\n})();\n\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('app')\r\n    .factory('FilterService', FilterService);\r\n\r\n  /** @ngInject */\r\n  function FilterService($uibModal, $log, $sce, GeoDataService, UtilsService) {\r\n    var _currentFilter = {\r\n      name: {\r\n        enabled: false,\r\n        value: ''\r\n      },\r\n      date: {\r\n        enabled: false,\r\n        startValue: '',\r\n        endValue: ''\r\n      },\r\n      gender: {\r\n        enabled: false,\r\n        value: ''\r\n      },\r\n      position: {\r\n        enabled: false,\r\n        startLatValue: '',\r\n        endLatValue: '',\r\n        startLngValue: '',\r\n        endLngValue: ''\r\n      }\r\n    };\r\n\r\n    var datepickerOptions = {\r\n      formatYear: 'yy',\r\n      startingDay: 1\r\n    };\r\n\r\n    var Service = {\r\n      filter: _currentFilter,\r\n      datepickerOptions: datepickerOptions,\r\n      filterDisplayText: getDisplay(),\r\n      openModal: openModal,\r\n      removeAll: removeAll,\r\n      removeAllAndRefresh: removeAllAndRefresh\r\n    };\r\n\r\n\r\n    function openModal() {\r\n      var modalInstance = $uibModal.open({\r\n        animation: true,\r\n        templateUrl: 'app/components/filter/erFilter.tpl.html',\r\n        controller: 'ErFilterController',\r\n        controllerAs: 'vm',\r\n        bindToController: true,\r\n        size: 'lg'\r\n      });\r\n\r\n      modalInstance.result.then(function () {\r\n        refreshData();\r\n      }, function () {\r\n        $log.info('Modal dismissed at: ' + new Date());\r\n      });\r\n    }\r\n\r\n    function removeAll() {\r\n      Service.filter.name.enabled = false;\r\n      Service.filter.date.enabled = false;\r\n      Service.filter.gender.enabled = false;\r\n      Service.filter.position.enabled = false;\r\n    }\r\n\r\n    function removeAllAndRefresh() {\r\n        removeAll();\r\n        refreshData();\r\n    }\r\n\r\n    function refreshData() {\r\n      Service.filterDisplayText = getDisplay();\r\n      GeoDataService.filterData(_currentFilter);\r\n    }\r\n\r\n    function getDisplay() {\r\n      var txt = '';\r\n\r\n      if(_currentFilter.name.enabled && _currentFilter.name.value != '') {\r\n        txt += '<span>Nom: <span class=\"val\">' + _currentFilter.name.value + '</span></span>';\r\n      }\r\n      if(_currentFilter.gender.enabled && _currentFilter.gender.value != '') {\r\n        txt += '<span>Genre: <span class=\"val\">' + (_currentFilter.gender.value == 'male' ? 'Homme' : 'Femme') + '</span></span>';\r\n      }\r\n      if(_currentFilter.date.enabled) {\r\n        if(_currentFilter.date.startValue != '') txt += '<span>Date début: <span class=\"val\">' + UtilsService.formatDate(_currentFilter.date.startValue) + '</span></span>';\r\n        if(_currentFilter.date.endValue != '') txt += '<span>Date fin: <span class=\"val\">' + UtilsService.formatDate(_currentFilter.date.endValue) + '</span></span>';\r\n      }\r\n      if(_currentFilter.position.enabled) {\r\n        if(_currentFilter.position.startLatValue != '') txt += '<span>Lat min: <span class=\"val\">' + _currentFilter.position.startLatValue + '</span></span>';\r\n        if(_currentFilter.position.endLatValue != '') txt += '<span>Lat max: <span class=\"val\">' + _currentFilter.position.endLatValue + '</span></span>';\r\n        if(_currentFilter.position.startLngValue != '') txt += '<span>Lng min: <span class=\"val\">' + _currentFilter.position.startLngValue + '</span></span>';\r\n        if(_currentFilter.position.endLngValue != '') txt += '<span>Lng max: <span class=\"val\">' + _currentFilter.position.endLngValue + '</span></span>';\r\n      }\r\n\r\n      return (txt == '' ? ' <span class=\"val\">Aucun filtre</span>' : $sce.trustAsHtml(txt));\r\n    }\r\n\r\n    return Service;\r\n  }\r\n})();\r\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/map',\n        template: '<er-main></er-main>'\n      });\n\n    $urlRouterProvider.otherwise('/map');\n  }\n\n})();\n\n/* global malarkey:false, moment:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .constant('Files', [\n      'assets/data/positions.json', \n      'assets/data/positions2.json', \n      'assets/data/positions3.json'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n  }\n\n})();\n\nangular.module(\"app\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/filter/erFilter.tpl.html\",\"<div class=\\\"erFilter\\\"><div class=\\\"modal-header\\\"><h3 class=\\\"modal-title\\\">Critères de filtrage:</h3></div><div class=\\\"modal-body\\\"><form name=\\\"vm.mainForm\\\" class=\\\"form-inline\\\"><table class=\\\"table table-hover\\\"><tbody><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.name.enabled\\\"> Nom:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.name.enabled}\\\"><form name=\\\"vm.nameForm\\\"><label>Contient: <input type=\\\"text\\\" ng-model=\\\"vm.filter.name.value\\\" ng-disabled=\\\"!vm.filter.name.enabled\\\" class=\\\"form-control\\\" required=\\\"\\\"></label></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.gender.enabled\\\"> Genre:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.gender.enabled}\\\"><form name=\\\"vm.genderForm\\\" class=\\\"form-inline\\\"><label class=\\\"radio-inline\\\"><input type=\\\"radio\\\" ng-model=\\\"vm.filter.gender.value\\\" ng-disabled=\\\"!vm.filter.gender.enabled\\\" name=\\\"inlineRadioOptions\\\" value=\\\"male\\\"> Homme</label> <label class=\\\"radio-inline\\\"><input type=\\\"radio\\\" ng-model=\\\"vm.filter.gender.value\\\" ng-disabled=\\\"!vm.filter.gender.enabled\\\" name=\\\"inlineRadioOptions\\\" value=\\\"female\\\"> Femme</label></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.date.enabled\\\"> Date:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.date.enabled}\\\"><form name=\\\"vm.dateForm\\\" class=\\\"form-inline\\\">Début:<div class=\\\"input-group\\\"><input type=\\\"date\\\" uib-datepicker-popup=\\\"dd/MM/yyyy\\\" ng-model=\\\"vm.filter.date.startValue\\\" is-open=\\\"vm.date.dateA.opened\\\" datepicker-options=\\\"vm.datepickerOptions\\\" date-disabled=\\\"!vm.filter.date.enabled\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\" close-text=\\\"Fermer\\\" class=\\\"form-control\\\" readonly=\\\"\\\"> <span class=\\\"input-group-btn\\\"><button type=\\\"button\\\" class=\\\"btn btn-default\\\" ng-click=\\\"vm.date.dateA.opened = true\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\"><i class=\\\"glyphicon glyphicon-calendar\\\"></i></button></span></div>- Fin:<div class=\\\"input-group\\\"><input type=\\\"date\\\" uib-datepicker-popup=\\\"dd/MM/yyyy\\\" ng-model=\\\"vm.filter.date.endValue\\\" is-open=\\\"vm.date.dateB.opened\\\" datepicker-options=\\\"vm.datepickerOptions\\\" date-disabled=\\\"!vm.filter.date.enabled\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\" close-text=\\\"Fermer\\\" class=\\\"form-control\\\" readonly=\\\"\\\"> <span class=\\\"input-group-btn\\\"><button type=\\\"button\\\" class=\\\"btn btn-default\\\" ng-click=\\\"vm.date.dateB.opened = true\\\" ng-disabled=\\\"!vm.filter.date.enabled\\\"><i class=\\\"glyphicon glyphicon-calendar\\\"></i></button></span></div></form></td></tr><tr><td><label><input type=\\\"checkbox\\\" ng-model=\\\"vm.filter.position.enabled\\\"> Position:</label></td><td ng-class=\\\"{\\'formOff\\': !vm.filter.position.enabled}\\\"><form name=\\\"vm.positionForm\\\"><label>Latitude min: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.startLatValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-90\\\" max=\\\"90\\\" step=\\\"0.001\\\" required=\\\"\\\"></label> <label>Latitude max: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.endLatValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-90\\\" max=\\\"90\\\" step=\\\"0.001\\\" required=\\\"\\\"></label><br><label>Longitude min: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.startLngValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-180\\\" max=\\\"180\\\" step=\\\"0.001\\\" required=\\\"\\\"></label> <label>Longitude max: <input type=\\\"number\\\" ng-model=\\\"vm.filter.position.endLngValue\\\" ng-disabled=\\\"!vm.filter.position.enabled\\\" class=\\\"form-control\\\" min=\\\"-180\\\" max=\\\"180\\\" step=\\\"0.001\\\" required=\\\"\\\"></label></form></td></tr></tbody></table></form></div><div class=\\\"modal-footer\\\"><button class=\\\"btn btn-danger pull-left\\\" type=\\\"button\\\" ng-click=\\\"vm.removeAll()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Supprimer</button> <button class=\\\"btn btn-primary\\\" type=\\\"button\\\" ng-click=\\\"vm.cancel()\\\">Fermer</button> <button class=\\\"btn btn-primary\\\" type=\\\"button\\\" ng-click=\\\"vm.filterData()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\"><span class=\\\"glyphicon glyphicon-filter\\\"></span> Filtrer</button></div></div>\");\n$templateCache.put(\"app/components/grid/erGrid.tpl.html\",\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 class=\\\"panel-title text-center\\\">Grille</h3></div><div class=\\\"panel-body\\\"><div ag-grid=\\\"vm.gridOptions\\\" class=\\\"ag-fresh\\\"></div></div></div>\");\n$templateCache.put(\"app/components/main/erMain.tpl.html\",\"<nav class=\\\"navbar navbar-inverse\\\"><div class=\\\"container\\\"><p class=\\\"navbar-text filter-bloc\\\"><strong>Filtres:</strong> <span ng-bind-html=\\\"vm.FilterService.filterDisplayText\\\" class=\\\"filter-display\\\"></span> <button ng-click=\\\"vm.FilterService.openModal()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"btn btn-sm btn-primary\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span> Modifier</button> <button ng-click=\\\"vm.FilterService.removeAllAndRefresh()\\\" ng-disabled=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"btn btn-sm btn-danger\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span> Supprimer</button> <span ng-show=\\\"vm.GeoDataService.mapWIP\\\" class=\\\"glyphicon glyphicon-time\\\"></span></p><p class=\\\"navbar-text navbar-right\\\"><strong>Données affichées:</strong> {{ vm.totalDisplayItems + \\' / \\' + vm.GeoDataService.totalItems }}<button class=\\\"btn btn-sm btn-danger\\\" style=\\\"opacity: 0;\\\">X</button></p></div></nav><div class=\\\"container-fluid\\\"><h1 ng-if=\\\"vm.GeoDataService.totalItems == 0\\\" class=\\\"text-center\\\">Chargement des positions..</h1><div ng-class=\\\"{\\'hideMe\\': vm.GeoDataService.totalItems == 0}\\\"><div class=\\\"col-md-6 col-sm-12\\\"><er-grid></er-grid></div><div class=\\\"col-md-6 col-sm-12\\\"><er-map></er-map></div></div></div>\");\n$templateCache.put(\"app/components/map/erMap.tpl.html\",\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 class=\\\"panel-title text-center\\\">Carte</h3></div><div class=\\\"panel-body\\\"><div id=\\\"progress\\\"><div id=\\\"progress-bar\\\"></div></div><div id=\\\"map\\\"></div></div></div>\");}]);"],"sourceRoot":"/source/"}