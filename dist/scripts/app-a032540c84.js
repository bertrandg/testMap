!function(){"use strict";angular.module("app",["ngAnimate","ngTouch","ngAria","ui.router","ui.bootstrap","agGrid","ui-leaflet"])}(),function(){"use strict";function e(){function e(e,t,n,a){function i(t){var n=[];c.clearLayers();for(var a=0;a<t.length;a++){var i=t[a];if(i.latitude&&i.longitude){var l=i.name,r=new L.Marker(new L.LatLng(i.latitude,i.longitude),{title:l});r.bindPopup(l),n.push(r)}}console.time("clustering"),c.addLayers(n),c.on("click",function(t){e.info("click > ",t)}),s.addLayer(c),console.timeEnd("clustering")}function l(e,t,a,i){var l=$("#progress",n)[0],r=$("#progress-bar",n)[0];a>1e3&&(l.style.display="block",r.style.width=Math.round(e/t*100)+"%"),e===t&&(l.style.display="none")}var r="http://{s}.tile.osm.org/{z}/{x}/{y}.png",o="Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade, Points &copy 2012 LINZ",d=new L.TileLayer(r,{maxZoom:21,attribution:o}),u=new L.LatLng(45.755658,4.834432),s=new L.Map("map",{center:u,zoom:13,layers:[d]}),c=new L.MarkerClusterGroup({chunkedLoading:!0,chunkProgress:l});a.list.subscribe(function(e){i(e)})}var t={restrict:"E",templateUrl:"app/components/map/erMap.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","$timeout","$element","MapService"],t}angular.module("app").directive("erMap",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.gridOptions=t.gridOptions,e.list.subscribe(function(e){n.gridOptions.rowData=e})}var t={restrict:"E",templateUrl:"app/components/grid/erGrid.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["MapService","GridService"],t}angular.module("app").directive("erGrid",e)}(),function(){"use strict";function e(e){var t=this;t.filter={name:{enabled:!1,value:""},date:{enabled:!1,startValue:"",endValue:""},gender:{enabled:!1,value:""},position:{enabled:!1,startLatValue:"",endLatValue:"",startLngValue:"",endLngValue:""}}}angular.module("app").controller("ErFilterController",e),e.$inject=["$modalInstance"]}(),function(){"use strict";function e(e,t,n,a){function i(){function i(e){angular.forEach(e,function(e){o=o.concat(e.data)}),n(function(){r.onNext(o)},1e3)}function l(t){e.error("XHR Failed for getData."+angular.toJson(t.data,!0))}var d=["assets/data/positions.json","assets/data/positions2.json","assets/data/positions3.json"];a.all(d.map(function(e){return t({method:"GET",url:e})})).then(i)["catch"](l)}function l(){}var r,o=[];L.Icon.Default.imagePath="assets/images/leaflet";var d={loadData:i,filterData:l,list:Rx.Observable.create(function(e){r=e,r.onNext(o)})};return d}angular.module("app").factory("MapService",e),e.$inject=["$log","$http","$timeout","$q"]}(),function(){"use strict";function e(){function e(e,n){var a=t(e),i=t(n);return null===a&&null===i?0:null===a?-1:null===i?1:a-i}function t(e){if(void 0===e||null===e||10!==e.length)return null;var t=e.substring(6,10),n=e.substring(3,5),a=e.substring(0,2),i=1e4*t+100*n+a;return i}var n=[{headerName:"Nom",field:"name"},{headerName:"Date",field:"registered",width:110,comparator:e},{headerName:"Genre",field:"gender",width:90},{headerName:"Téléphone",field:"phone"},{headerName:"Lat",field:"latitude",width:90},{headerName:"Lon",field:"longitude",width:90},{headerName:"Id",field:"id"}],a={columnDefs:n,enableSorting:!0,pinnedColumnCount:1,rowData:[]},i={gridOptions:a};return i}angular.module("app").factory("GridService",e)}(),function(){"use strict";function e(e,t,n){function a(){return"Aucun filtre"}function i(){var n=e.open({animation:!0,templateUrl:"app/components/filter/erFilter.tpl.html",controller:"ErFilterController",size:"lg"});n.result.then(function(e){t.info(">>: "+e)},function(){t.info("Modal dismissed at: "+new Date)})}var l={getDisplay:a,openModal:i};return l}angular.module("app").factory("FilterService",e),e.$inject=["$modal","$log","MapService"]}(),function(){"use strict";function e(e,t){var n=this;n.filter=t,n.totalItems=0,e.list.subscribe(function(e){n.totalItems=e.length}),e.loadData()}angular.module("app").controller("MainController",e),e.$inject=["MapService","FilterService"]}(),function(){"use strict";function e(e,t){e.state("home",{url:"/map",templateUrl:"app/main/main.tpl.html",controller:"MainController",controllerAs:"vm"}),t.otherwise("/map")}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e){e.debugEnabled(!0)}angular.module("app").config(e),e.$inject=["$logProvider"]}(),angular.module("app").run(["$templateCache",function(e){e.put("app/main/main.tpl.html",'<div class="container-fluid"><div class="col-md-12"><h2>Visualisation des données: {{ vm.totalItems }} items</h2><p><strong>Filtres:</strong> {{ vm.filter.getDisplay() }} <button ng-click="vm.filter.openModal()" class="btn btn-sm btn-primary">Ajouter/Modifier</button> <button ng-click="deleteFilter()" class="btn btn-sm btn-danger">Supprimer</button></p></div><h1 ng-if="vm.totalItems == 0" class="text-center">Chargement des positions..</h1><div ng-if="vm.totalItems > 0"><div class="col-md-6 col-sm-12"><er-grid></er-grid></div><div class="col-md-6 col-sm-12"><er-map></er-map></div></div></div>'),e.put("app/components/filter/erFilter.tpl.html",'<div class="modal-header"><h3 class="modal-title">Filtrage des résultats:</h3></div><div class="modal-body"><form name="mainForm"><div><label><input type="checkbox" ng-model="vm.filter.gender.enabled"> Genre:</label><form name="genderForm"><label><input type="radio" ng-model="vm.filter.gender.value = \'male\'"> Homme</label> <label><input type="radio" ng-model="vm.filter.gender.value = \'female\'"> Femme</label></form></div><div><label><input type="checkbox" ng-model="vm.filter.date.enabled"> Date:</label><form name="dateForm"><label>Début:<input type="text" ng-model="vm.filter.date.startValue"></label> <label>Fin: <input type="text" ng-model="vm.filter.date.endValue"></label></form></div><div><label><input type="checkbox" ng-model="vm.filter.name.enabled">Nom:</label><form name="nameForm"><input type="text" ng-model="vm.filter.name.value"></form></div><div><label><input type="checkbox" ng-model="vm.filter.position.enabled">Position:</label><form name="positionForm"><label>Latitude min: <input type="text" ng-model="vm.filter.position.startLatValue"></label> <label>Latitude max: <input type="text" ng-model="vm.filter.position.endLatValue"></label> <label>Longitude min: <input type="text" ng-model="vm.filter.position.startLngValue"></label> <label>Longitude max: <input type="text" ng-model="vm.filter.position.endLngValue"></label></form></div></form></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div>'),e.put("app/components/grid/erGrid.tpl.html",'<div><p>erMap directive</p><div ag-grid="vm.gridOptions" class="ag-fresh"></div></div>'),e.put("app/components/map/erMap.tpl.html",'<div><p>erGrid directive</p><div id="progress"><div id="progress-bar"></div></div><div id="map"></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-a032540c84.js.map
