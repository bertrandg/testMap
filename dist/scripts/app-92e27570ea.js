!function(){"use strict";angular.module("app",["ngAnimate","ngTouch","ngSanitize","ngAria","ui.router","ui.bootstrap","agGrid"])}(),function(){"use strict";function e(){function e(e,t,a,n){function l(e){if(o.removeLayer(s),s.clearLayers(),0!=e.length){n.mapWIP=!0;for(var t=[],a=0;a<e.length;a++){var l=e[a];if(l.latitude&&l.longitude){var i=new L.Marker(new L.LatLng(l.latitude,l.longitude),{id:l.id});t.push(i)}}console.time("clustering"),s.addLayers(t),s.on("click",r),o.addLayer(s),console.timeEnd("clustering")}}function i(e,l,i,r){var o=$("#progress",a)[0],s=$("#progress-bar",a)[0];i>1e3&&(o.style.display="block",s.style.width=Math.round(e/l*100)+"%"),e===l&&(o.style.display="none",t(function(){n.mapWIP=!1}))}function r(t){e.info("click > ",t)}var o=new L.Map("map",{center:new L.LatLng(45.755658,4.834432),zoom:13,layers:[new L.TileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:21})]}),s=new L.MarkerClusterGroup({chunkedLoading:!0,chunkProgress:i});n.list.subscribe(function(t){e.log("Observable subscriber called ---> MAP ",t.length),l(t)})}var t={restrict:"E",templateUrl:"app/components/map/erMap.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","$timeout","$element","GeoDataService"],t}angular.module("app").directive("erMap",e)}(),function(){"use strict";function e(e,t,a){var n=this;n.filter=a.filter,n.datepickerOptions=a.datepickerOptions,n.date={dateA:{opened:!1},dateB:{opened:!1}},n.removeAll=function(){a.removeAll(),e.close(n.filter)},n.filterData=function(){e.close(n.filter)},n.cancel=function(){e.dismiss("cancel")}}angular.module("app").controller("ErFilterController",e),e.$inject=["$uibModalInstance","$log","FilterService"]}(),function(){"use strict";function e(){function e(e,t,a){var n=this;n.GeoDataService=t,n.FilterService=a,n.totalDisplayItems=0,t.list.subscribe(function(t){e.log("Observable subscriber called ---> MAIN ",t.length),n.totalDisplayItems=t.length}),t.loadData()}var t={restrict:"E",templateUrl:"app/components/main/erMain.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","GeoDataService","FilterService"],t}angular.module("app").directive("erMain",e)}(),function(){"use strict";function e(){function e(e,t,a,n){var l=this;l.gridOptions=n.gridOptions,a.list.subscribe(function(t){e.log("Observable subscriber called ---> GRID ",t.length),l.gridOptions.api.setRowData(t)})}var t={restrict:"E",templateUrl:"app/components/grid/erGrid.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","$timeout","GeoDataService","GridService"],t}angular.module("app").directive("erGrid",e)}(),function(){"use strict";function e(e){function t(t){return e("date")(t,"dd/MM/yyyy")}var a={formatDate:t};return a}angular.module("app").factory("UtilsService",e),e.$inject=["$filter"]}(),function(){"use strict";function e(){function e(e,a){var n=t(e),l=t(a);return null===n&&null===l?0:null===n?-1:null===l?1:n-l}function t(e){if(void 0===e||null===e||10!==e.length)return null;var t=e.substring(6,10),a=e.substring(3,5),n=e.substring(0,2),l=1e4*t+100*a+n;return l}var a=[{headerName:"Nom",field:"name"},{headerName:"Date",field:"registered",width:110,comparator:e},{headerName:"Genre",field:"gender",width:90},{headerName:"Téléphone",field:"phone"},{headerName:"Lat",field:"latitude",width:90},{headerName:"Lon",field:"longitude",width:90},{headerName:"Id",field:"id"}],n={columnDefs:a,enableSorting:!0,pinnedColumnCount:1,rowData:[]},l={gridOptions:n,dateComparator:e};return l}angular.module("app").factory("GridService",e)}(),function(){"use strict";function e(e,t,a,n,l,i,r){function o(){function l(e){angular.forEach(e,function(e){p=p.concat(e.data)}),a(function(){u.totalItems=p.length,d.onNext(p)},1e3)}function i(t){e.error("XHR Failed for getData."+angular.toJson(t.data,!0))}n.all(r.map(function(e){return t({method:"GET",url:e})})).then(l)["catch"](i)}function s(e){a(function(){return e.name.enabled||e.gender.enabled||e.position.enabled||e.date.enabled?(c=p.filter(function(t){if(e.name.enabled&&""!=e.name.value&&-1==t.name.indexOf(e.name.value))return!1;if(e.gender.enabled&&""!=e.gender.value&&t.gender!=e.gender.value)return!1;if(e.position.enabled){if(""!=e.position.startLatValue&&t.latitude<e.position.startLatValue)return!1;if(""!=e.position.endLatValue&&t.latitude>e.position.endLatValue)return!1;if(""!=e.position.startLngValue&&t.longitude<e.position.startLngValue)return!1;if(""!=e.position.endLngValue&&t.longitude>e.position.endLngValue)return!1}if(e.date.enabled){if(""!=e.date.startValue&&l.dateComparator(i.formatDate(e.date.startValue),t.registered)>0)return!1;if(""!=e.date.endValue&&l.dateComparator(i.formatDate(e.date.endValue),t.registered)<0)return!1}return!0}),void d.onNext(c)):void d.onNext(p)})}var d,p=[],c=[];L.Icon.Default.imagePath="assets/images/leaflet";var u={loadData:o,filterData:s,totalItems:0,mapWIP:!0,list:Rx.Observable.create(function(e){d=e}).share()};return a(function(){d.onNext(p)}),u}angular.module("app").factory("GeoDataService",e),e.$inject=["$log","$http","$timeout","$q","GridService","UtilsService","Files"]}(),function(){"use strict";function e(e,t,a,n,l){function i(){var a=e.open({animation:!0,templateUrl:"app/components/filter/erFilter.tpl.html",controller:"ErFilterController",controllerAs:"vm",bindToController:!0,size:"lg"});a.result.then(function(){s()},function(){t.info("Modal dismissed at: "+new Date)})}function r(){u.filter.name.enabled=!1,u.filter.date.enabled=!1,u.filter.gender.enabled=!1,u.filter.position.enabled=!1}function o(){r(),s()}function s(){u.filterDisplayText=d(),n.filterData(p)}function d(){var e="";return p.name.enabled&&""!=p.name.value&&(e+='<span>Nom: <span class="val">'+p.name.value+"</span></span>"),p.gender.enabled&&""!=p.gender.value&&(e+='<span>Genre: <span class="val">'+("male"==p.gender.value?"Homme":"Femme")+"</span></span>"),p.date.enabled&&(""!=p.date.startValue&&(e+='<span>Date début: <span class="val">'+l.formatDate(p.date.startValue)+"</span></span>"),""!=p.date.endValue&&(e+='<span>Date fin: <span class="val">'+l.formatDate(p.date.endValue)+"</span></span>")),p.position.enabled&&(""!=p.position.startLatValue&&(e+='<span>Lat min: <span class="val">'+p.position.startLatValue+"</span></span>"),""!=p.position.endLatValue&&(e+='<span>Lat max: <span class="val">'+p.position.endLatValue+"</span></span>"),""!=p.position.startLngValue&&(e+='<span>Lng min: <span class="val">'+p.position.startLngValue+"</span></span>"),""!=p.position.endLngValue&&(e+='<span>Lng max: <span class="val">'+p.position.endLngValue+"</span></span>")),""==e?' <span class="val">Aucun filtre</span>':a.trustAsHtml(e)}var p={name:{enabled:!1,value:""},date:{enabled:!1,startValue:"",endValue:""},gender:{enabled:!1,value:""},position:{enabled:!1,startLatValue:"",endLatValue:"",startLngValue:"",endLngValue:""}},c={formatYear:"yy",startingDay:1},u={filter:p,datepickerOptions:c,filterDisplayText:d(),openModal:i,removeAll:r,removeAllAndRefresh:o};return u}angular.module("app").factory("FilterService",e),e.$inject=["$uibModal","$log","$sce","GeoDataService","UtilsService"]}(),function(){"use strict";function e(e,t){e.state("home",{url:"/map",template:"<er-main></er-main>"}),t.otherwise("/map")}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("app").constant("Files",["assets/data/positions.json","assets/data/positions2.json","assets/data/positions3.json"])}(),function(){"use strict";function e(e){e.debugEnabled(!0)}angular.module("app").config(e),e.$inject=["$logProvider"]}(),angular.module("app").run(["$templateCache",function(e){e.put("app/components/filter/erFilter.tpl.html",'<div class="erFilter"><div class="modal-header"><h3 class="modal-title">Critères de filtrage:</h3></div><div class="modal-body"><form name="vm.mainForm" class="form-inline"><table class="table table-hover"><tbody><tr><td><label><input type="checkbox" ng-model="vm.filter.name.enabled"> Nom:</label></td><td ng-class="{\'formOff\': !vm.filter.name.enabled}"><form name="vm.nameForm"><label>Contient: <input type="text" ng-model="vm.filter.name.value" ng-disabled="!vm.filter.name.enabled" class="form-control" required=""></label></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.gender.enabled"> Genre:</label></td><td ng-class="{\'formOff\': !vm.filter.gender.enabled}"><form name="vm.genderForm" class="form-inline"><label class="radio-inline"><input type="radio" ng-model="vm.filter.gender.value" ng-disabled="!vm.filter.gender.enabled" name="inlineRadioOptions" value="male"> Homme</label> <label class="radio-inline"><input type="radio" ng-model="vm.filter.gender.value" ng-disabled="!vm.filter.gender.enabled" name="inlineRadioOptions" value="female"> Femme</label></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.date.enabled"> Date:</label></td><td ng-class="{\'formOff\': !vm.filter.date.enabled}"><form name="vm.dateForm" class="form-inline">Début:<div class="input-group"><input type="date" uib-datepicker-popup="dd/MM/yyyy" ng-model="vm.filter.date.startValue" is-open="vm.date.dateA.opened" datepicker-options="vm.datepickerOptions" date-disabled="!vm.filter.date.enabled" ng-disabled="!vm.filter.date.enabled" close-text="Fermer" class="form-control" readonly=""> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="vm.date.dateA.opened = true" ng-disabled="!vm.filter.date.enabled"><i class="glyphicon glyphicon-calendar"></i></button></span></div>- Fin:<div class="input-group"><input type="date" uib-datepicker-popup="dd/MM/yyyy" ng-model="vm.filter.date.endValue" is-open="vm.date.dateB.opened" datepicker-options="vm.datepickerOptions" date-disabled="!vm.filter.date.enabled" ng-disabled="!vm.filter.date.enabled" close-text="Fermer" class="form-control" readonly=""> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="vm.date.dateB.opened = true" ng-disabled="!vm.filter.date.enabled"><i class="glyphicon glyphicon-calendar"></i></button></span></div></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.position.enabled"> Position:</label></td><td ng-class="{\'formOff\': !vm.filter.position.enabled}"><form name="vm.positionForm"><label>Latitude min: <input type="number" ng-model="vm.filter.position.startLatValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-90" max="90" step="0.001" required=""></label> <label>Latitude max: <input type="number" ng-model="vm.filter.position.endLatValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-90" max="90" step="0.001" required=""></label><br><label>Longitude min: <input type="number" ng-model="vm.filter.position.startLngValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-180" max="180" step="0.001" required=""></label> <label>Longitude max: <input type="number" ng-model="vm.filter.position.endLngValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-180" max="180" step="0.001" required=""></label></form></td></tr></tbody></table></form></div><div class="modal-footer"><button class="btn btn-danger pull-left" type="button" ng-click="vm.removeAll()" ng-disabled="vm.GeoDataService.mapWIP"><span class="glyphicon glyphicon-remove"></span> Supprimer</button> <button class="btn btn-primary" type="button" ng-click="vm.cancel()">Fermer</button> <button class="btn btn-primary" type="button" ng-click="vm.filterData()" ng-disabled="vm.GeoDataService.mapWIP"><span class="glyphicon glyphicon-filter"></span> Filtrer</button></div></div>'),e.put("app/components/grid/erGrid.tpl.html",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title text-center">Grille</h3></div><div class="panel-body"><div ag-grid="vm.gridOptions" class="ag-fresh"></div></div></div>'),e.put("app/components/main/erMain.tpl.html",'<nav class="navbar navbar-inverse"><div class="container"><p class="navbar-text filter-bloc"><strong>Filtres:</strong> <span ng-bind-html="vm.FilterService.filterDisplayText" class="filter-display"></span> <button ng-click="vm.FilterService.openModal()" ng-disabled="vm.GeoDataService.mapWIP" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-pencil"></span> Modifier</button> <button ng-click="vm.FilterService.removeAllAndRefresh()" ng-disabled="vm.GeoDataService.mapWIP" class="btn btn-sm btn-danger"><span class="glyphicon glyphicon-remove"></span> Supprimer</button> <span ng-show="vm.GeoDataService.mapWIP" class="glyphicon glyphicon-time"></span></p><p class="navbar-text navbar-right"><strong>Données affichées:</strong> {{ vm.totalDisplayItems + \' / \' + vm.GeoDataService.totalItems }}<button class="btn btn-sm btn-danger" style="opacity: 0;">X</button></p></div></nav><div class="container-fluid"><h1 ng-if="vm.GeoDataService.totalItems == 0" class="text-center">Chargement des positions..</h1><div ng-class="{\'hideMe\': vm.GeoDataService.totalItems == 0}"><div class="col-md-6 col-sm-12"><er-grid></er-grid></div><div class="col-md-6 col-sm-12"><er-map></er-map></div></div></div>'),e.put("app/components/map/erMap.tpl.html",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title text-center">Carte</h3></div><div class="panel-body"><div id="progress"><div id="progress-bar"></div></div><div id="map"></div></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-92e27570ea.js.map
