!function(){"use strict";angular.module("app",["ngAnimate","ngTouch","ngSanitize","ngAria","ui.router","ui.bootstrap","agGrid"])}(),function(){"use strict";function e(){function e(e,t,a,n){function l(e){if(s&&(o.removeLayer(s),s.clearLayers(),s=null),0!=e.length){n.mapWIP=!0,console.time("clustering");for(var a=[],l=0;l<e.length;l++){var d=e[l];if(d.latitude&&d.longitude){var c=new L.Marker(new L.LatLng(d.latitude,d.longitude),{id:d.id});a.push(c)}}t(function(){s=new L.MarkerClusterGroup({chunkedLoading:!0,chunkProgress:i}),s.addLayers(a),s.on("click",r),o.addLayer(s)})}}function i(e,l,i,r){var o=$("#progress",a)[0],s=$("#progress-bar",a)[0];i>1e3&&(o.style.display="block",s.style.width=Math.round(e/l*100)+"%"),e===l&&(o.style.display="none",console.timeEnd("clustering"),t(function(){n.mapWIP=!1}))}function r(t){e.info("click > ",t)}var o=new L.Map("map",{center:new L.LatLng(45.755658,4.834432),zoom:13,layers:[new L.TileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:21})]}),s=null;n.list.subscribe(function(t){e.log("Observable subscriber called ---> MAP ",t.length),l(t)})}var t={restrict:"E",templateUrl:"app/components/map/erMap.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","$timeout","$element","GeoDataService"],t}angular.module("app").directive("erMap",e)}(),function(){"use strict";function e(e,t){var a=this;a.item=t,a.close=function(){e.close()}}angular.module("app").controller("ItemDetailsModalController",e),e.$inject=["$uibModalInstance","item"]}(),function(){"use strict";function e(){function e(e,t,a){var n=this;n.GeoDataService=t,n.FilterService=a,n.totalDisplayItems=0,t.list.subscribe(function(t){e.log("Observable subscriber called ---> MAIN ",t.length),n.totalDisplayItems=t.length}),t.loadData()}var t={restrict:"E",templateUrl:"app/components/main/erMain.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","GeoDataService","FilterService"],t}angular.module("app").directive("erMain",e)}(),function(){"use strict";function e(){function e(e,t,a,n){var l=this;l.gridOptions=n.gridOptions,a.list.subscribe(function(t){e.log("Observable subscriber called ---> GRID ",t.length),l.gridOptions.api.setRowData(t)})}var t={restrict:"E",templateUrl:"app/components/grid/erGrid.tpl.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["$log","$timeout","GeoDataService","GridService"],t}angular.module("app").directive("erGrid",e)}(),function(){"use strict";function e(e,t,a){var n=this;n.filter=a.filter,n.datepickerOptions=a.datepickerOptions,n.date={dateA:{opened:!1},dateB:{opened:!1}},n.removeAll=function(){a.removeAll(),e.close(n.filter)},n.filterData=function(){e.close(n.filter)},n.cancel=function(){e.dismiss("cancel")}}angular.module("app").controller("ErFilterModalController",e),e.$inject=["$uibModalInstance","$log","FilterService"]}(),function(){"use strict";function e(e){function t(t){return e("date")(t,"dd/MM/yyyy")}var a={formatDate:t};return a}angular.module("app").factory("UtilsService",e),e.$inject=["$filter"]}(),function(){"use strict";function e(e,t){function a(a){e.open({animation:!0,templateUrl:"app/components/itemsDetailsModal/itemsDetailsModal.tpl.html",controller:"ItemDetailsModalController",controllerAs:"vm",bindToController:!0,size:"lg",resolve:{item:t.getItem(a)}})}var n={openModal:a};return n}angular.module("app").factory("ItemDetailsService",e),e.$inject=["$uibModal","GeoDataService"]}(),function(){"use strict";function e(){function e(e,a){var n=t(e),l=t(a);return null===n&&null===l?0:null===n?-1:null===l?1:n-l}function t(e){if(void 0===e||null===e||10!==e.length)return null;var t=e.substring(6,10),a=e.substring(3,5),n=e.substring(0,2),l=1e4*t+100*a+n;return l}function a(e){return"female"==e.value?"Femme":"Homme"}var n=[{headerName:"Nom",field:"name"},{headerName:"Date",field:"registered",width:110,comparator:e},{headerName:"Genre",field:"gender",width:90,cellRenderer:a},{headerName:"Téléphone",field:"phone"},{headerName:"Lat",field:"latitude",width:90},{headerName:"Lon",field:"longitude",width:90},{headerName:"Id",field:"id"}],l={columnDefs:n,enableSorting:!0,pinnedColumnCount:1,rowData:[]},i={gridOptions:l,dateComparator:e};return i}angular.module("app").factory("GridService",e)}(),function(){"use strict";function e(e,t,a,n,l,i,r){function o(){function l(e){angular.forEach(e,function(e){p=p.concat(e.data)}),a(function(){u.totalItems=p.length,c.onNext(p)},1e3)}function i(t){e.error("XHR Failed for getData."+angular.toJson(t.data,!0))}n.all(r.map(function(e){return t({method:"GET",url:e})})).then(l)["catch"](i)}function s(e){return _.find(p,function(t){t.id=e})}function d(e){a(function(){return e.name.enabled||e.gender.enabled||e.position.enabled||e.date.enabled?(m=p.filter(function(t){if(e.name.enabled&&""!=e.name.value&&-1==t.name.indexOf(e.name.value))return!1;if(e.gender.enabled&&""!=e.gender.value&&t.gender!=e.gender.value)return!1;if(e.position.enabled){if(""!=e.position.startLatValue&&t.latitude<e.position.startLatValue)return!1;if(""!=e.position.endLatValue&&t.latitude>e.position.endLatValue)return!1;if(""!=e.position.startLngValue&&t.longitude<e.position.startLngValue)return!1;if(""!=e.position.endLngValue&&t.longitude>e.position.endLngValue)return!1}if(e.date.enabled){if(""!=e.date.startValue&&l.dateComparator(i.formatDate(e.date.startValue),t.registered)>0)return!1;if(""!=e.date.endValue&&l.dateComparator(i.formatDate(e.date.endValue),t.registered)<0)return!1}return!0}),void c.onNext(m)):void c.onNext(p)})}var c,p=[],m=[];L.Icon.Default.imagePath="assets/images/leaflet";var u={totalItems:0,mapWIP:!0,list:Rx.Observable.create(function(e){c=e}).share(),loadData:o,filterData:d,getItem:s};return a(function(){c.onNext(p)}),u}angular.module("app").factory("GeoDataService",e),e.$inject=["$log","$http","$timeout","$q","GridService","UtilsService","Files"]}(),function(){"use strict";function e(e,t,a,n,l){function i(){var a=e.open({animation:!0,templateUrl:"app/components/filterModal/erFilterModal.tpl.html",controller:"ErFilterModalController",controllerAs:"vm",bindToController:!0,size:"lg"});a.result.then(function(){s()},function(){t.info("Modal dismissed at: "+new Date)})}function r(){m.filter.name.enabled=!1,m.filter.date.enabled=!1,m.filter.gender.enabled=!1,m.filter.position.enabled=!1}function o(){r(),s()}function s(){m.filterDisplayText=d(),n.filterData(c)}function d(){var e="";return c.name.enabled&&""!=c.name.value&&(e+='<span>Nom: <span class="val">'+c.name.value+"</span></span>"),c.gender.enabled&&""!=c.gender.value&&(e+='<span>Genre: <span class="val">'+("male"==c.gender.value?"Homme":"Femme")+"</span></span>"),c.date.enabled&&(""!=c.date.startValue&&(e+='<span>Date début: <span class="val">'+l.formatDate(c.date.startValue)+"</span></span>"),""!=c.date.endValue&&(e+='<span>Date fin: <span class="val">'+l.formatDate(c.date.endValue)+"</span></span>")),c.position.enabled&&(""!=c.position.startLatValue&&(e+='<span>Lat min: <span class="val">'+c.position.startLatValue+"</span></span>"),""!=c.position.endLatValue&&(e+='<span>Lat max: <span class="val">'+c.position.endLatValue+"</span></span>"),""!=c.position.startLngValue&&(e+='<span>Lng min: <span class="val">'+c.position.startLngValue+"</span></span>"),""!=c.position.endLngValue&&(e+='<span>Lng max: <span class="val">'+c.position.endLngValue+"</span></span>")),""==e?' <span class="val">Aucun filtre</span>':a.trustAsHtml(e)}var c={name:{enabled:!1,value:""},date:{enabled:!1,startValue:"",endValue:""},gender:{enabled:!1,value:""},position:{enabled:!1,startLatValue:"",endLatValue:"",startLngValue:"",endLngValue:""}},p={formatYear:"yy",startingDay:1},m={filter:c,datepickerOptions:p,filterDisplayText:d(),openModal:i,removeAll:r,removeAllAndRefresh:o};return m}angular.module("app").factory("FilterService",e),e.$inject=["$uibModal","$log","$sce","GeoDataService","UtilsService"]}(),function(){"use strict";function e(e,t){e.state("home",{url:"/map",template:"<er-main></er-main>"}),t.otherwise("/map")}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("app").constant("Files",["assets/data/positions.json","assets/data/positions2.json","assets/data/positions3.json"])}(),function(){"use strict";function e(e){e.debugEnabled(!0)}angular.module("app").config(e),e.$inject=["$logProvider"]}(),angular.module("app").run(["$templateCache",function(e){e.put("app/components/filterModal/erFilterModal.tpl.html",'<div class="erFilterModal"><div class="modal-header"><h3 class="modal-title">Critères de filtrage:</h3></div><div class="modal-body"><form name="vm.mainForm" class="form-inline"><table class="table table-hover"><tbody><tr><td><label><input type="checkbox" ng-model="vm.filter.name.enabled"> Nom:</label></td><td ng-class="{\'formOff\': !vm.filter.name.enabled}"><form name="vm.nameForm"><label>Contient: <input type="text" ng-model="vm.filter.name.value" ng-disabled="!vm.filter.name.enabled" class="form-control" required=""></label></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.gender.enabled"> Genre:</label></td><td ng-class="{\'formOff\': !vm.filter.gender.enabled}"><form name="vm.genderForm" class="form-inline"><label class="radio-inline"><input type="radio" ng-model="vm.filter.gender.value" ng-disabled="!vm.filter.gender.enabled" name="inlineRadioOptions" value="male"> Homme</label> <label class="radio-inline"><input type="radio" ng-model="vm.filter.gender.value" ng-disabled="!vm.filter.gender.enabled" name="inlineRadioOptions" value="female"> Femme</label></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.date.enabled"> Date:</label></td><td ng-class="{\'formOff\': !vm.filter.date.enabled}"><form name="vm.dateForm" class="form-inline">Début:<div class="input-group"><input type="date" uib-datepicker-popup="dd/MM/yyyy" ng-model="vm.filter.date.startValue" is-open="vm.date.dateA.opened" datepicker-options="vm.datepickerOptions" date-disabled="!vm.filter.date.enabled" ng-disabled="!vm.filter.date.enabled" close-text="Fermer" class="form-control" readonly=""> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="vm.date.dateA.opened = true" ng-disabled="!vm.filter.date.enabled"><i class="glyphicon glyphicon-calendar"></i></button></span></div>- Fin:<div class="input-group"><input type="date" uib-datepicker-popup="dd/MM/yyyy" ng-model="vm.filter.date.endValue" is-open="vm.date.dateB.opened" datepicker-options="vm.datepickerOptions" date-disabled="!vm.filter.date.enabled" ng-disabled="!vm.filter.date.enabled" close-text="Fermer" class="form-control" readonly=""> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="vm.date.dateB.opened = true" ng-disabled="!vm.filter.date.enabled"><i class="glyphicon glyphicon-calendar"></i></button></span></div></form></td></tr><tr><td><label><input type="checkbox" ng-model="vm.filter.position.enabled"> Position:</label></td><td ng-class="{\'formOff\': !vm.filter.position.enabled}"><form name="vm.positionForm"><label>Latitude min: <input type="number" ng-model="vm.filter.position.startLatValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-90" max="90" step="0.001" required=""></label> <label>Latitude max: <input type="number" ng-model="vm.filter.position.endLatValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-90" max="90" step="0.001" required=""></label><br><label>Longitude min: <input type="number" ng-model="vm.filter.position.startLngValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-180" max="180" step="0.001" required=""></label> <label>Longitude max: <input type="number" ng-model="vm.filter.position.endLngValue" ng-disabled="!vm.filter.position.enabled" class="form-control" min="-180" max="180" step="0.001" required=""></label></form></td></tr></tbody></table></form></div><div class="modal-footer"><button class="btn btn-danger pull-left" type="button" ng-click="vm.removeAll()" ng-disabled="vm.GeoDataService.mapWIP"><span class="glyphicon glyphicon-remove"></span> Supprimer</button> <button class="btn btn-primary" type="button" ng-click="vm.cancel()">Fermer</button> <button class="btn btn-primary" type="button" ng-click="vm.filterData()" ng-disabled="vm.GeoDataService.mapWIP"><span class="glyphicon glyphicon-filter"></span> Filtrer</button></div></div>'),e.put("app/components/grid/erGrid.tpl.html",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title text-center">Grille</h3></div><div class="panel-body"><div ag-grid="vm.gridOptions" class="ag-fresh"></div></div></div>'),e.put("app/components/itemDetailsModal/itemDetailsModal.tpl.html",'<div class="itemDetailsModal"><div class="modal-header"><h3 class="modal-title">Détails:</h3></div><div class="modal-body"><form name="vm.mainForm" class="form-inline"><table class="table table-hover"><tbody><tr><td></td><td></td></tr></tbody></table></form></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="vm.close()">Fermer</button></div></div>'),e.put("app/components/main/erMain.tpl.html",'<nav class="navbar navbar-inverse"><div class="container"><p class="navbar-text filter-bloc"><strong>Filtres:</strong> <span ng-bind-html="vm.FilterService.filterDisplayText" class="filter-display"></span> <button ng-click="vm.FilterService.openModal()" ng-disabled="vm.GeoDataService.mapWIP" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-pencil"></span> Modifier</button> <button ng-click="vm.FilterService.removeAllAndRefresh()" ng-disabled="vm.GeoDataService.mapWIP" class="btn btn-sm btn-danger"><span class="glyphicon glyphicon-remove"></span> Supprimer</button> <span ng-show="vm.GeoDataService.mapWIP" class="glyphicon glyphicon-time"></span></p><p class="navbar-text navbar-right"><strong>Données affichées:</strong> {{ vm.totalDisplayItems + \' / \' + vm.GeoDataService.totalItems }}<button class="btn btn-sm btn-danger" style="opacity: 0;">X</button></p></div></nav><div class="container-fluid"><div ng-if="vm.GeoDataService.totalItems == 0" class="text-center"><span class="badge">Chargement des fichiers..</span></div><div ng-class="{\'hideMe\': vm.GeoDataService.totalItems == 0}"><div class="col-md-6 col-sm-12"><er-grid></er-grid></div><div class="col-md-6 col-sm-12"><er-map></er-map></div></div></div>'),e.put("app/components/map/erMap.tpl.html",'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title text-center">Carte</h3></div><div class="panel-body"><div id="progress"><div id="progress-bar"></div></div><div id="map"></div></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-e70176ce41.js.map
